# upstream api_servers {
#     #least_conn; # ✨ الگوریتم: هر کی خلوت‌تره
#     server todo-api:9091;
# }
server {
    listen 80;
    server_name todo.localhost;

    access_log /var/log/nginx/todo-web-access.log main;
    error_log  /var/log/nginx/todo-web-error.log  warn;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";

    proxy_intercept_errors on;
    
    error_page 404 /errors/404.html;
    
    location ^~ /errors/ {
        internal;
        root /usr/share/nginx/html;
    }


    location /api/todos/health {
        proxy_pass http://todo-api:9091/api/health;
    }

    location /api/todos {
        proxy_pass http://todo-api:9091;
    }

    location /api/auth/health {
        proxy_pass http://todo-profile:9093/api/health;
    }

    location /api/auth/ {
        proxy_pass http://todo-profile:9093;
    }

    location / {
        proxy_pass http://todo-web:9092;
    }
}